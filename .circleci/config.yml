version: 2.1

references:
  workspace_root: &workspace_root
    /tmp/workspace
  attach_workspace: &attach_workspace
    attach_workspace:
      at: *workspace_root

jobs:
  build_centos7_installer:
    docker:
      - image: sgpearse/vapor3-centos7:latest

    steps:
      - checkout

      - run:
          name: cmake3 and make
          command: |
            cd /root/project/build
            git checkout $CIRCLE_BRANCH
            cmake3 -DCMAKE_BUILD_TYPE:String=Release -DDIST_INSTALLER:string=ON -DUSE_OMP=ON ..
            make
            make installer
            mkdir -p /tmp/installers
            mv *.sh /tmp/installers


      - store_artifacts:
          path: /tmp/installers

workflows:
  build:
    jobs:
      - build_centos7_installer
